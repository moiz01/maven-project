pipeline {
     agent {
        label 'build'
    }
    
    stages {
     stage('Build war'){
            steps {
                sh 'mvn clean package'
            }
            post {
                success {
                    echo 'Now Archiving...'
                    archiveArtifacts artifacts: '**/target/*.war'
                }
            }
        }
       
     stage('Build war'){
            steps {
                sh 'mvn clean package'
            }
            post {
                success {
                    echo 'Now Archiving...'
                    archiveArtifacts artifacts: '**/target/*.war'
                }
            }
        }
    stage('Build') {
          
            steps {
                // Your build steps here
                // For example: Maven build, compile, etc.

               copyArtifacts(projectName: 'package', selector: specific('**/*.war'))
            }
        }
 }
    
    post {
        always {
            // Deploy WAR/EAR to Tomcat
            deployWarToTomcat(
                warFiles: '**/*.war',
                managerUser: 'admin',
                managerPassword: 'rp@P8on!',
                tomcatUrl: 'http://54.91.14.25:8090'
            )
        }
    }
}

def deployWarToTomcat(Map params) {
    // Retrieve parameters
    def warFiles = params.warFiles
    def managerUser = params.managerUser
    def managerPassword = params.managerPassword
    def tomcatUrl = params.tomcatUrl
    

    
    // Deploy WAR/EAR to Tomcat using the Deploy plugin
    echo "Deploying WAR files to Tomcat..."
    deploy adapters: [tomcat8(credentialsId: 'tomcat-credentials', url: tomcatUrl, path: '/manager/text')], contextPath: '', war: warFiles
}


    
    post {
        always {
            // Deploy WAR/EAR to Tomcat
            deployWarToTomcat(
                warFiles: '**/*.war',
                managerUser: 'admin',
                managerPassword: 'rp@P8on!',
                tomcatUrl: 'http://54.91.14.25:8090'
            )
        }
    }


def deployWarToTomcat(Map params) {
    // Retrieve parameters
    def warFiles = params.warFiles
    def managerUser = params.managerUser
    def managerPassword = params.managerPassword
    def tomcatUrl = params.tomcatUrl
    

    
    // Deploy WAR/EAR to Tomcat using the Deploy plugin
    echo "Deploying WAR files to Tomcat..."
    deploy adapters: [tomcat8(credentialsId: 'tomcat-credentials', url: tomcatUrl, path: '/manager/text')], contextPath: '', war: warFiles
}

